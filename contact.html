<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contact • Markos Ioannou</title>

  <!-- Uses your existing site stylesheet -->
  <link rel="stylesheet" href="styles.css" />
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>

<body>
  <div class="shell">
    <header class="nav">
      <div class="nav-left">
        <div class="logo-circle">M</div>
        <div class="brand-text">
          <div class="brand-name">Markos Ioannou</div>
          <div class="brand-tag">Contact</div>
        </div>
      </div>

      <a class="pill-btn" href="index.html">← Back</a>
    </header>

    <main>
      <!-- LEFT: form panel -->
      <section class="panel">
        <div class="badge-row">
          <span class="badge-pill">Contact</span>
          Send me a message
        </div>

        <h1>Let’s talk</h1>
        <p class="subtitle">
          Fill in the form and I’ll get back to you. (No disposable email addresses.)
        </p>

        <form id="contact-form" class="contact-form" novalidate>
          <div class="field-row">
            <div class="field">
              <label for="name">Name</label>
              <input id="name" name="name" type="text" autocomplete="name" required />
            </div>

            <div class="field">
              <label for="email">Email</label>
              <input id="email" name="email" type="email" autocomplete="email" required />
            </div>
          </div>

          <div class="field">
            <label for="subject">Subject</label>
            <input id="subject" name="subject" type="text" required />
          </div>

          <div class="field">
            <label for="message">Message</label>
            <textarea id="message" name="message" rows="6" required></textarea>
          </div>

          <!-- Turnstile (anti-bot) -->
          <div class="cf-turnstile"
               data-sitekey="0x4AAAAAACGPrYNWH3UJ-UKd"
               data-theme="dark"
               data-callback="onTurnstileOk"
               data-expired-callback="onTurnstileExpired">
          </div>
          
          <div class="form-actions">
            <button class="btn-main" id="submit-btn" type="submit">✉️ Send message</button>
            <span id="form-status" class="form-status" aria-live="polite"></span>
          </div>
        </form>

        <!-- Note:
             If you later add Turnstile, we’ll drop the widget right here above the button,
             and include its token in the payload. -->
      </section>

      <!-- RIGHT: links panel -->
      <aside class="panel-right">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Find me</div>
            <div class="card-kicker">Links</div>
          </div>

          <div class="card-link-row">
            <!-- Note: replace these with your real URLs -->
            <a class="card-link" href="https://www.linkedin.com/in/YOUR-LINKEDIN" target="_blank" rel="noreferrer">LinkedIn</a>
            <a class="card-link" href="https://github.com/YOUR-GITHUB" target="_blank" rel="noreferrer">GitHub</a>
            <a class="card-link" href="mailto:markos@markos-ioannou.com">Email</a>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Email</div>
            <div class="card-kicker">Direct</div>
          </div>
          <div style="color:#9ca3af; line-height:1.6;">
            markos@markos-ioannou.com
          </div>
        </div>
      </aside>
    </main>

    <footer class="footer">
      <div>© <span id="year"></span> Markos Ioannou</div>
      <div><a href="index.html">Home</a></div>
    </footer>
  </div>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const WORKER_ENDPOINT = "https://contact-form.markosioannou.workers.dev";

  const form = document.getElementById("contact-form");
  const statusEl = document.getElementById("form-status");
  const submitBtn = document.getElementById("submit-btn");

  // Turnstile token gets stored here
  let turnstileToken = "";

  // Turnstile callbacks (called by the widget)
  window.onTurnstileOk = (token) => {
    turnstileToken = token;
    statusEl.textContent = "";
    submitBtn.disabled = false;
  };

  window.onTurnstileExpired = () => {
    turnstileToken = "";
    submitBtn.disabled = true;
    statusEl.textContent = "Please complete the anti-spam check again.";
  };

  // Optional: disable submit until Turnstile completes
  submitBtn.disabled = true;

  // Disposable email blocking (client-side UX)
  const DISPOSABLE = new Set([
    "mailinator.com","yopmail.com","tempmail.com","10minutemail.com",
    "guerrillamail.com","guerrillamail.net","trashmail.com","getnada.com",
    "maildrop.cc","sharklasers.com"
  ]);

  function okEmailFormat(email) {
    const e = (email || "").trim().toLowerCase();
    if (e.length > 254) return false;
    if (e.includes("..")) return false;
    const at = e.indexOf("@");
    if (at <= 0 || at !== e.lastIndexOf("@")) return false;
    const domain = e.slice(at + 1);
    if (!domain.includes(".")) return false;
    const tld = domain.split(".").pop();
    if (!tld || tld.length < 2) return false;
    return true;
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    statusEl.textContent = "";

    const payload = {
      name: form.name.value.trim(),
      email: form.email.value.trim().toLowerCase(),
      subject: form.subject.value.trim(),
      message: form.message.value.trim(),
      turnstileToken
    };

    if (!payload.name || !payload.email || !payload.subject || !payload.message) {
      statusEl.textContent = "Please fill in all fields.";
      return;
    }

    if (!okEmailFormat(payload.email)) {
      statusEl.textContent = "Please enter a valid email address.";
      return;
    }

    const domain = payload.email.split("@")[1] || "";
    if (DISPOSABLE.has(domain)) {
      statusEl.textContent = "Disposable email addresses are not allowed.";
      return;
    }

    if (!turnstileToken) {
      statusEl.textContent = "Please complete the anti-spam check.";
      return;
    }

    submitBtn.disabled = true;
    statusEl.textContent = "Sending…";

    try {
      const res = await fetch(WORKER_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (!res.ok) {
        const t = await res.text().catch(() => "");
        statusEl.textContent = t || "Could not send. Please try again.";
        submitBtn.disabled = false;
        return;
      }

      form.reset();
      turnstileToken = "";
      statusEl.textContent = "Sent ✔ Thanks!";
      // Turnstile will re-enable the button when user completes it again
      submitBtn.disabled = true;
    } catch {
      statusEl.textContent = "Network error. Please try again.";
      submitBtn.disabled = false;
    }
  });
</script>
</body>
</html>
